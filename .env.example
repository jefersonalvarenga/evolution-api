# ============================================================
# EVOLUTION API v2 - Variáveis de Ambiente
# Baseado no .env.example oficial do Evolution API v2
# Copie este arquivo para .env e preencha os valores
# ============================================================

# --- Servidor ---
SERVER_NAME=evolution
SERVER_TYPE=http
SERVER_PORT=8080
# URL pública da VPS/domínio (sem barra no final)
SERVER_URL=https://evolution.seudominio.com

# --- Log ---
LOG_LEVEL=ERROR,WARN
LOG_COLOR=true
LOG_BAILEYS=error

# --- Instâncias ---
# Tempo para deletar instância sem conexão (false = nunca)
DEL_INSTANCE=false

# --- Banco de Dados (Supabase) ---
#
# ATENÇÃO: são necessárias DUAS connection strings diferentes:
#
# 1. DATABASE_CONNECTION_URI → porta 6543 (pooler) → usada pela aplicação em runtime
#    Supabase → Settings → Database → Connection pooling → URI
#
# 2. DATABASE_URL → porta 5432 (direta) → usada pelo Prisma Migrate para criar as tabelas
#    Supabase → Settings → Database → Connection string → URI
#    Adicione ?pgbouncer=false&connection_limit=1 ao final
#
# Substitua [YOUR-PASSWORD] pela sua senha do Supabase nas duas URLs abaixo

DATABASE_PROVIDER=postgresql

# Conexão da aplicação (runtime) — pooler porta 6543
DATABASE_CONNECTION_URI=postgresql://postgres.sqbidkenikaqlvdlizot:[YOUR-PASSWORD]@aws-1-sa-east-1.pooler.supabase.com:6543/postgres?schema=public

# Conexão do Prisma Migrate (migrations) — direta porta 5432
DATABASE_URL=postgresql://postgres.sqbidkenikaqlvdlizot:[YOUR-PASSWORD]@aws-1-sa-east-1.pooler.supabase.com:5432/postgres?schema=public&pgbouncer=false&connection_limit=1

DATABASE_CONNECTION_CLIENT_NAME=evolution_easyscale

# O que salvar no banco
DATABASE_SAVE_DATA_INSTANCE=true
DATABASE_SAVE_DATA_NEW_MESSAGE=true
DATABASE_SAVE_MESSAGE_UPDATE=true
DATABASE_SAVE_DATA_CONTACTS=true
DATABASE_SAVE_DATA_CHATS=true
DATABASE_SAVE_DATA_LABELS=true
DATABASE_SAVE_DATA_HISTORIC=true
DATABASE_SAVE_IS_ON_WHATSAPP=true
DATABASE_SAVE_IS_ON_WHATSAPP_DAYS=7
DATABASE_DELETE_MESSAGE=true

# OU, se preferir PostgreSQL local (docker compose --profile local-db):
# DATABASE_CONNECTION_URI=postgresql://evolution:senha@postgres:5432/evolution?schema=public

# --- Cache Redis ---
# Senha do Redis (deve ser a mesma configurada no serviço Redis do Easypanel)
REDIS_PASSWORD=mude-esta-senha-redis-aqui

# ATENÇÃO: o hostname do Redis no Easypanel segue o padrão <projeto>_<serviço>
# Exemplo: projeto "easyscale" + serviço "redis-evolution-api" = easyscale_redis-evolution-api
# Para desenvolvimento local com docker compose, use apenas: redis
CACHE_REDIS_ENABLED=true
CACHE_REDIS_URI=redis://:SUA_SENHA_REDIS@easyscale_redis-evolution-api:6379/6
CACHE_REDIS_TTL=604800
CACHE_REDIS_PREFIX_KEY=evolution
CACHE_REDIS_SAVE_INSTANCES=false
CACHE_LOCAL_ENABLED=false

# --- Autenticação Global ---
# Gere uma chave forte: openssl rand -hex 32
AUTHENTICATION_API_KEY=mude-esta-chave-forte-aqui
AUTHENTICATION_EXPOSE_IN_FETCH_INSTANCES=true

# --- Webhook Global ---
# Deixe desabilitado para configurar por instância individualmente no n8n
WEBHOOK_GLOBAL_ENABLED=false
WEBHOOK_GLOBAL_URL=
WEBHOOK_GLOBAL_WEBHOOK_BY_EVENTS=false

# Eventos de webhook
WEBHOOK_EVENTS_APPLICATION_STARTUP=false
WEBHOOK_EVENTS_QRCODE_UPDATED=true
WEBHOOK_EVENTS_MESSAGES_SET=false
WEBHOOK_EVENTS_MESSAGES_UPSERT=true
WEBHOOK_EVENTS_MESSAGES_EDITED=false
WEBHOOK_EVENTS_MESSAGES_UPDATE=true
WEBHOOK_EVENTS_MESSAGES_DELETE=false
WEBHOOK_EVENTS_SEND_MESSAGE=false
WEBHOOK_EVENTS_SEND_MESSAGE_UPDATE=false
WEBHOOK_EVENTS_CONTACTS_SET=false
WEBHOOK_EVENTS_CONTACTS_UPSERT=false
WEBHOOK_EVENTS_CONTACTS_UPDATE=false
WEBHOOK_EVENTS_PRESENCE_UPDATE=false
WEBHOOK_EVENTS_CHATS_SET=false
WEBHOOK_EVENTS_CHATS_UPSERT=false
WEBHOOK_EVENTS_CHATS_UPDATE=false
WEBHOOK_EVENTS_CHATS_DELETE=false
WEBHOOK_EVENTS_GROUPS_UPSERT=false
WEBHOOK_EVENTS_GROUPS_UPDATE=false
WEBHOOK_EVENTS_GROUP_PARTICIPANTS_UPDATE=false
WEBHOOK_EVENTS_CONNECTION_UPDATE=true
WEBHOOK_EVENTS_REMOVE_INSTANCE=false
WEBHOOK_EVENTS_LOGOUT_INSTANCE=false
WEBHOOK_EVENTS_LABELS_EDIT=false
WEBHOOK_EVENTS_LABELS_ASSOCIATION=false
WEBHOOK_EVENTS_CALL=false
WEBHOOK_EVENTS_ERRORS=false

WEBHOOK_REQUEST_TIMEOUT_MS=60000
WEBHOOK_RETRY_MAX_ATTEMPTS=10
WEBHOOK_RETRY_INITIAL_DELAY_SECONDS=5
WEBHOOK_RETRY_USE_EXPONENTIAL_BACKOFF=true
WEBHOOK_RETRY_MAX_DELAY_SECONDS=300
WEBHOOK_RETRY_JITTER_FACTOR=0.2
WEBHOOK_RETRY_NON_RETRYABLE_STATUS_CODES=400,401,403,404,422

# --- QR Code ---
QRCODE_LIMIT=30
QRCODE_COLOR=#175197

# --- Identificação no WhatsApp ---
CONFIG_SESSION_PHONE_CLIENT=Evolution API
CONFIG_SESSION_PHONE_NAME=Chrome

# --- Telemetria ---
TELEMETRY_ENABLED=false

# --- Idioma ---
LANGUAGE=pt-BR

# --- Integrações (desabilitadas por padrão) ---
RABBITMQ_ENABLED=false
WEBSOCKET_ENABLED=false
OPENAI_ENABLED=false
TYPEBOT_ENABLED=false
CHATWOOT_ENABLED=false
S3_ENABLED=false
N8N_ENABLED=false

# --- Somente se usar postgres local (docker compose --profile local-db) ---
POSTGRES_DB=evolution
POSTGRES_USER=evolution
POSTGRES_PASSWORD=mude-esta-senha-forte-aqui
